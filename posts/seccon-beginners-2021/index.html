<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SECCON Beginners CTF 2021 参加記 | yoshikingのへや</title><meta name=keywords content="rsa,lll,knapsack,matrix"><meta name=description content="⚠️ Wrteupではなく&#34;参加記&#34;です。読み物としてご覧ください。 書いてみたらそんなことはないかも、いやそうかも？わかんない
はじめに 一人チーム(UdagawaWhiteBears)で出て、42位2602点でした。 内訳としては、cryptoとrevは全部解き、他ジャンルは簡単な問題をいくつか解きました。
普通にwriteup書いてもな〜(なんで?)となったので、今回はどのような流れでcryptoを解いていったのか流れを書いていこうと思います。 なんでこんなことをやりだしたかというと、ptr-yudaiが書いたTSG LIVE ! 6 CTFのWriteupが面白かったからです。 あとは、数式を書くのが面倒だからです（ぶっちゃけ）。
作問者writeupも出ていますし、SECCON Beginnersなので日本人の参加者は多いと思うので、詳細は他の人が書いてくれるでしょうと信じています。 あと、全然理解せずにこいつ解いてるんだな〜みたいな様子が伝わればいいなと思います😇
開始前 16:00から開始だと思ってたら14:00からで、ちょっと焦った記憶があります（遅刻はしてないけど）。 pwnerと違ってcrytpoでは特に準備することがありません。 わくわくしておけば💯だと思います。
真面目な話をすると、先述のptr-yudaiの記事ではpythonとsageをまず実行しておくと次に起動するときに早くなるらしいですが、全然知らなかったしやってないです。 まあ誤差でしょう()
戦略的にはcrypto全部解きたいな〜ぐらいに考えていて、beginner向けなので、難しい問題から手をつけていこうと思っていました。
はじまりはじまり〜🎉 14:00! はじまり〜〜、わくわくしすぎてワクワクさんになりました。
早速、問題に取り掛かろうと思うのですが、ファイルのダウンロードができません😢 問題サーバーは生きてるので、ncする問題(Imaginary)があったのでこれを見てみることにしました（難しい問題からやる？そんなことはとうの昔に忘れました）。
[crypto] Imaginary 接続した感じと問題文で、わぁ〜なんか虚数じゃん、ツラと思います。
$ nc imaginary.quals.beginners.seccon.jp 1337 Welcome to Secret IMAGINARY NUMBER Store! 1. Save a number 2. Show numbers 3. Import numbers 4. Export numbers 0. Exit > べそをかいていると、ファイルのダウンロードができるようになりました。 さすがLMT、30秒もかかってないんじゃないでしょうか（適当）。
ファイルを見ていきます。
うえ〜〜、100行以上あるじゃん、ぴえんです。 CTFというのはフラグと呼ばれる文字列を見つけるゲームなので、とりあえずCtrl + sでflagを探してみます(emacs user)。
def _secret(self): if '1337i' in self."><meta name=author content="yoshiking"><link rel=canonical href=https://y05h1k1ng.github.io/posts/seccon-beginners-2021/><link href=/assets/css/stylesheet.min.1eef9c740af75b4e5f773d9d5f757e03e3df71f3a308e73070cc73d55a59a7d7.css integrity="sha256-Hu+cdAr3W05fdz2dX3V+A+PfcfOjCOcwcMxz1VpZp9c=" rel="preload stylesheet" as=style><link rel=icon href=https://y05h1k1ng.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://y05h1k1ng.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://y05h1k1ng.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://y05h1k1ng.github.io/apple-touch-icon.png><link rel=mask-icon href=https://y05h1k1ng.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.110.0"><link rel=alternate hreflang=ja href=https://y05h1k1ng.github.io/posts/seccon-beginners-2021/><script async src="https://www.googletagmanager.com/gtag/js?id=G-B2J7S4D4B4"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-B2J7S4D4B4")</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-151020420-2","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="SECCON Beginners CTF 2021 参加記"><meta property="og:description" content="⚠️ Wrteupではなく&#34;参加記&#34;です。読み物としてご覧ください。 書いてみたらそんなことはないかも、いやそうかも？わかんない
はじめに 一人チーム(UdagawaWhiteBears)で出て、42位2602点でした。 内訳としては、cryptoとrevは全部解き、他ジャンルは簡単な問題をいくつか解きました。
普通にwriteup書いてもな〜(なんで?)となったので、今回はどのような流れでcryptoを解いていったのか流れを書いていこうと思います。 なんでこんなことをやりだしたかというと、ptr-yudaiが書いたTSG LIVE ! 6 CTFのWriteupが面白かったからです。 あとは、数式を書くのが面倒だからです（ぶっちゃけ）。
作問者writeupも出ていますし、SECCON Beginnersなので日本人の参加者は多いと思うので、詳細は他の人が書いてくれるでしょうと信じています。 あと、全然理解せずにこいつ解いてるんだな〜みたいな様子が伝わればいいなと思います😇
開始前 16:00から開始だと思ってたら14:00からで、ちょっと焦った記憶があります（遅刻はしてないけど）。 pwnerと違ってcrytpoでは特に準備することがありません。 わくわくしておけば💯だと思います。
真面目な話をすると、先述のptr-yudaiの記事ではpythonとsageをまず実行しておくと次に起動するときに早くなるらしいですが、全然知らなかったしやってないです。 まあ誤差でしょう()
戦略的にはcrypto全部解きたいな〜ぐらいに考えていて、beginner向けなので、難しい問題から手をつけていこうと思っていました。
はじまりはじまり〜🎉 14:00! はじまり〜〜、わくわくしすぎてワクワクさんになりました。
早速、問題に取り掛かろうと思うのですが、ファイルのダウンロードができません😢 問題サーバーは生きてるので、ncする問題(Imaginary)があったのでこれを見てみることにしました（難しい問題からやる？そんなことはとうの昔に忘れました）。
[crypto] Imaginary 接続した感じと問題文で、わぁ〜なんか虚数じゃん、ツラと思います。
$ nc imaginary.quals.beginners.seccon.jp 1337 Welcome to Secret IMAGINARY NUMBER Store! 1. Save a number 2. Show numbers 3. Import numbers 4. Export numbers 0. Exit > べそをかいていると、ファイルのダウンロードができるようになりました。 さすがLMT、30秒もかかってないんじゃないでしょうか（適当）。
ファイルを見ていきます。
うえ〜〜、100行以上あるじゃん、ぴえんです。 CTFというのはフラグと呼ばれる文字列を見つけるゲームなので、とりあえずCtrl + sでflagを探してみます(emacs user)。
def _secret(self): if '1337i' in self."><meta property="og:type" content="article"><meta property="og:url" content="https://y05h1k1ng.github.io/posts/seccon-beginners-2021/"><meta property="article:published_time" content="2021-05-23T15:10:29+09:00"><meta property="article:modified_time" content="2021-05-23T15:10:29+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SECCON Beginners CTF 2021 参加記"><meta name=twitter:description content="⚠️ Wrteupではなく&#34;参加記&#34;です。読み物としてご覧ください。 書いてみたらそんなことはないかも、いやそうかも？わかんない
はじめに 一人チーム(UdagawaWhiteBears)で出て、42位2602点でした。 内訳としては、cryptoとrevは全部解き、他ジャンルは簡単な問題をいくつか解きました。
普通にwriteup書いてもな〜(なんで?)となったので、今回はどのような流れでcryptoを解いていったのか流れを書いていこうと思います。 なんでこんなことをやりだしたかというと、ptr-yudaiが書いたTSG LIVE ! 6 CTFのWriteupが面白かったからです。 あとは、数式を書くのが面倒だからです（ぶっちゃけ）。
作問者writeupも出ていますし、SECCON Beginnersなので日本人の参加者は多いと思うので、詳細は他の人が書いてくれるでしょうと信じています。 あと、全然理解せずにこいつ解いてるんだな〜みたいな様子が伝わればいいなと思います😇
開始前 16:00から開始だと思ってたら14:00からで、ちょっと焦った記憶があります（遅刻はしてないけど）。 pwnerと違ってcrytpoでは特に準備することがありません。 わくわくしておけば💯だと思います。
真面目な話をすると、先述のptr-yudaiの記事ではpythonとsageをまず実行しておくと次に起動するときに早くなるらしいですが、全然知らなかったしやってないです。 まあ誤差でしょう()
戦略的にはcrypto全部解きたいな〜ぐらいに考えていて、beginner向けなので、難しい問題から手をつけていこうと思っていました。
はじまりはじまり〜🎉 14:00! はじまり〜〜、わくわくしすぎてワクワクさんになりました。
早速、問題に取り掛かろうと思うのですが、ファイルのダウンロードができません😢 問題サーバーは生きてるので、ncする問題(Imaginary)があったのでこれを見てみることにしました（難しい問題からやる？そんなことはとうの昔に忘れました）。
[crypto] Imaginary 接続した感じと問題文で、わぁ〜なんか虚数じゃん、ツラと思います。
$ nc imaginary.quals.beginners.seccon.jp 1337 Welcome to Secret IMAGINARY NUMBER Store! 1. Save a number 2. Show numbers 3. Import numbers 4. Export numbers 0. Exit > べそをかいていると、ファイルのダウンロードができるようになりました。 さすがLMT、30秒もかかってないんじゃないでしょうか（適当）。
ファイルを見ていきます。
うえ〜〜、100行以上あるじゃん、ぴえんです。 CTFというのはフラグと呼ばれる文字列を見つけるゲームなので、とりあえずCtrl + sでflagを探してみます(emacs user)。
def _secret(self): if '1337i' in self."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://y05h1k1ng.github.io/posts/"},{"@type":"ListItem","position":2,"name":"SECCON Beginners CTF 2021 参加記","item":"https://y05h1k1ng.github.io/posts/seccon-beginners-2021/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SECCON Beginners CTF 2021 参加記","name":"SECCON Beginners CTF 2021 参加記","description":"⚠️ Wrteupではなく\u0026amp;quot;参加記\u0026amp;quot;です。読み物としてご覧ください。 書いてみたらそんなことはないかも、いやそうかも？わかんない\nはじめに 一人チーム(UdagawaWhiteBears)で出て、42位2602点でした。 内訳としては、cryptoとrevは全部解き、他ジャンルは簡単な問題をいくつか解きました。\n普通にwriteup書いて …","keywords":["rsa","lll","knapsack","matrix"],"articleBody":" ⚠️ Wrteupではなく\"参加記\"です。読み物としてご覧ください。 書いてみたらそんなことはないかも、いやそうかも？わかんない\nはじめに 一人チーム(UdagawaWhiteBears)で出て、42位2602点でした。 内訳としては、cryptoとrevは全部解き、他ジャンルは簡単な問題をいくつか解きました。\n普通にwriteup書いてもな〜(なんで?)となったので、今回はどのような流れでcryptoを解いていったのか流れを書いていこうと思います。 なんでこんなことをやりだしたかというと、ptr-yudaiが書いたTSG LIVE ! 6 CTFのWriteupが面白かったからです。 あとは、数式を書くのが面倒だからです（ぶっちゃけ）。\n作問者writeupも出ていますし、SECCON Beginnersなので日本人の参加者は多いと思うので、詳細は他の人が書いてくれるでしょうと信じています。 あと、全然理解せずにこいつ解いてるんだな〜みたいな様子が伝わればいいなと思います😇\n開始前 16:00から開始だと思ってたら14:00からで、ちょっと焦った記憶があります（遅刻はしてないけど）。 pwnerと違ってcrytpoでは特に準備することがありません。 わくわくしておけば💯だと思います。\n真面目な話をすると、先述のptr-yudaiの記事ではpythonとsageをまず実行しておくと次に起動するときに早くなるらしいですが、全然知らなかったしやってないです。 まあ誤差でしょう()\n戦略的にはcrypto全部解きたいな〜ぐらいに考えていて、beginner向けなので、難しい問題から手をつけていこうと思っていました。\nはじまりはじまり〜🎉 14:00! はじまり〜〜、わくわくしすぎてワクワクさんになりました。\n早速、問題に取り掛かろうと思うのですが、ファイルのダウンロードができません😢 問題サーバーは生きてるので、ncする問題(Imaginary)があったのでこれを見てみることにしました（難しい問題からやる？そんなことはとうの昔に忘れました）。\n[crypto] Imaginary 接続した感じと問題文で、わぁ〜なんか虚数じゃん、ツラと思います。\n$ nc imaginary.quals.beginners.seccon.jp 1337 Welcome to Secret IMAGINARY NUMBER Store! 1. Save a number 2. Show numbers 3. Import numbers 4. Export numbers 0. Exit \u003e べそをかいていると、ファイルのダウンロードができるようになりました。 さすがLMT、30秒もかかってないんじゃないでしょうか（適当）。\nファイルを見ていきます。\nうえ〜〜、100行以上あるじゃん、ぴえんです。 CTFというのはフラグと呼ばれる文字列を見つけるゲームなので、とりあえずCtrl + sでflagを探してみます(emacs user)。\ndef _secret(self): if '1337i' in self.numbers: self.request.sendall(b'Congratulations!\\n') self.request.sendall(f'The flag is {flag}\\n'.encode()) いますね。 self.numbersに1337iが含まれていればOKっぽいです。 あとは_secret(self)を呼んでいる箇所を探します。 Ctrl + sで(略)\nelif num == 5: self._secret() ？？？、おまっ？どこから湧いてきたんや！？\n失礼、近所の関西弁のおじさんが出てきてしまいましたが、気にせずにいきましょう。\n接続した際にはいなかった、選択肢がありましたね。 とりあえず、この辺でflagを得る道筋がすこし見えてきました。 今わかっている限りでは、self.numbersに1337iをsaveとかで含めて、5を呼べば良さそうです。\nとりあえず、self.numbersに値を入れたいので、_save()を見に行きます。\ndef _save(self): try: self.request.sendall(b'Real part\u003e ') re = int(self.request.recv(128).strip()) self.request.sendall(b'Imaginary part\u003e ') im = int(self.request.recv(128).strip()) name = f'{re} + {im}i' self.numbers[name] = [re, im] except ValueError: pass なんのcheckも入っていません。 てか、self.numbersが配列かな〜と勝手に推測していたのですが、dictです。 え？これ入れるだけでは？と思って試してみます。\n$ nc imaginary.quals.beginners.seccon.jp 1337 Welcome to Secret IMAGINARY NUMBER Store! 1. Save a number 2. Show numbers 3. Import numbers 4. Export numbers 0. Exit \u003e 1 Real part\u003e 0 Imaginary part\u003e 1337 1. Save a number 2. Show numbers 3. Import numbers 4. Export numbers 0. Exit \u003e 2 -------------------------------------------------- 0 + 1337i: (0, 1337) -------------------------------------------------- う、なるほど、0が入るのね〜とわかります。\nここで、これpythonで hoge in dictって、比較されるのkey?value?と思って確認します。\n$ python3 Python 3.8.5 (default, Jan 27 2021, 15:41:15) [GCC 9.3.0] on linux Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. \u003e\u003e\u003e a = {\"x\": 1} \u003e\u003e\u003e \"x\" in a True \u003e\u003e\u003e 1 in a False \u003e\u003e\u003e 御意。 さっきやった実験では、0 + 1337iがkeyに入っているので、これではダメそうです。\nまだ、_save()を見ただけなので、もう一つ値を入れれそうな_import()を見ます。\ndef _import(self): self.request.sendall(b'Exported String\u003e ') data = self.request.recv(1024).strip().decode() enc = bytes.fromhex(data) cipher = AES.new(key, AES.MODE_ECB) plaintext = unpad(cipher.decrypt(enc), AES.block_size) self.numbers = json.loads(plaintext.decode()) self.request.sendall(b'Imported.\\n') self._show() AESの文字がちらつきます。 cryptoになってきました。 虚数から数学問の可能性がありましたが、そうではなさそうです。 与えた文字列をAESのECBモードで復号してから、self.numberにjson.dumpしたものを代入しています。 ECBモードなので、まぁ、なんかできるでしょう！という気持ちになります。\n残るは_exportを見ていきます（_show()には申し訳ないが、スルーさせてもらう）。\ndef _export(self): cipher = AES.new(key, AES.MODE_ECB) dump = pad(json.dumps(self.numbers).encode(), AES.block_size) self.request.sendall(dump + b'\\n') enc = cipher.encrypt(dump) self.request.sendall(b'Exported:\\n') self.request.sendall(enc.hex().encode() + b'\\n') こちらも、特に変わったことはしてなくて、self.numberを文字列にして暗号化したものがもらえます。\nここで、ECBモードなので、“いい感じ\"にブロックを分けて作ってから、がっちゃんこすればOKみたいな方針が立ちます。ECBモードだと、基本的には同じ平文は同じ暗号文になることを使いがちムーブをしていきます。\nさて、どうやるといい感じになるかな〜と手元で試してみます。\nfrom json import dumps def gen_blocks(s): return [s[i:i+16] for i in range(0, len(s), 16)] x = {\"-100 + 1000i\": [-100, 1000], \"0 + 1337i\": [0, 1337]} s = dumps(x) blocks = gen_blocks(s) for block in blocks: print(block) $ python3 test.py {\"-100 + 1000i\": [-100, 1000], \" 0 + 1337i\": [0, 1337]} なんで、マイナスとかつけちゃってるの？という気もしますが、つけたい気分だったんでしょう。 わかりません。\n...], \"と1337i\":...をがっちゃんこすれば...],　\"1337i\":...となり、良さそうですね。 あとは、1337i\":...から始まるブロックを調整して作って、後ろの2ブロックを使えば、念願のフラグゲットです。\nsaveで、{\"-100 + 1000i\": [-100, 1000], \"0 + 1337i\": [0, 1337]}となるように値を入れます。 これを、exportして前の2ブロックを使います。 一度、接続を切ってから、次はx = {\"10 + 1000i\": [10, 1000], \"0 + 1337i\": [0, 1337]}となるようにsaveしていきます。 また、exportして次は後ろの2ブロックを使って、前の2ブロックと今回の後ろ2ブロックをつなげたhex値をimportします。 これで隠し選択肢5を選択すれば、フラグゲットです🚩\nctf4b{yeah_you_are_a_member_of_imaginary_number_club}\nたぶん、30分前後で解けたと思います。 記憶が正しければfirst bloodを頂いていたはずですが、今回のスコアサーバーでは解いた問題の情報が見れないので真相は闇の中…\nここまで書いてきましたが、普通にWriteupを書くより大変ということに気づいて泣いています。 解法の詳細は他の人に譲って、考えてることを軽く書こうとしてたら、試行錯誤付きのwriteupになってしまって大変疲労しています。 ここからは、解法の詳細は他の人、と復唱しながら書いていきます。\n[crypto] p-8RSA 気を取り直して、次こそは一番むずかしい問題に取り組みます。\nファイルを落としてきます。 問題名からRSAであることは自明ですが、簡単な問題であることを祈ります🙏\nばっと見た感じ暗号化は普通のRSAで、素数の生成が特殊なようです。 qを生成した後、pの生成はqから8を引いていって素数になるまで回してそうです。\nお！これはpとqの差がそこまでなさそうという気持ちになるので、fermat法とかで素因数分解できそうです。 fermat法のスクリプトもってねーと思ったので、google先生にsage fermat factorizationと聞いてみると、いい感じのコードが乗っているサイトを見つけました。 コピって、ペってします。\nyoshiking@yoshiking-vm:~/ctf/seccon_begginers/p-8RSA$ sage ┌────────────────────────────────────────────────────────────────────┐ │ SageMath version 9.2, Release Date: 2020-10-24 │ │ Using Python 3.8.5. Type \"help()\" for help. │ └────────────────────────────────────────────────────────────────────┘ sage: n = 1692217701880003415077640053307690427052236117123084244791201925961363188187081357161572555509365632685003108528944898394703205166453173384730181508859979770089258399395605909244353802395195544 ....: 75266121835753044660177349444503693993991253475530436734034224314165897550185719665717183285653938232013807360458249 ....: e = 17 ....: c = 1002331319313602783327343416523045558140944872521511317352860746165554027951907976470018896694722907709258390131313562125744552746904221132780155717506533655129986694531619553020085990299191012 ....: 44702933443124944274359143831492874463245444294673660944786888148517110942002726017336219552279179125115273728023902 ....: sage: def fermatfactor(N): ....: if N \u003c= 0: return [N] ....: if is_even(N): return [2,N/2] ....: a = ceil(sqrt(N)) ....: while not is_square(a^2-N): ....: a = a + 1 ....: b = sqrt(a^2-N) ....: return [a - b,a + b] ....: sage: fermatfactor(n) [13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844727189, 13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844741541] わいわい\nできてそうですね。 あとは、復号するだけじゃん〜〜と思っていたんですが、素数生成時にpが素数になるまでと他にも条件がありました…\nif isPrime(p) and GCD(phi, e) != 1: break GCD(phi, e) != 1はツラ\nといっても、よくあることなのでがんばります。\n片方の素数は $(p-1)\\nmid e$だったので、pでニセd作って復号できんじゃね？と思ったら、しっかりとパディングされていました。ぴえん。\nflag = flag.encode(\"utf-8\") + urandom(64) のこる手札は、GCD(phi, e)で割ってやる方法ですが、これもGCD(phi, e) = 17なので、ぴえんこえてぱおん。\nもう手札0だよ〜〜ぴえんぴえんとしていると、ある記事を思い出します(bookmarkにあった)。\n中国語の記事だけど、よくまとまってると思います。 https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/\nここに乗ってなかったかな〜と思うと、ありました！！ ばんざい🙌\nここでもコピってペっとすればOKと言いたいところですが、記事に乗っている方法は$(p-1) | e$ かつ $(q-1) | e$なので少々オーバーキルです。 そのあたりのスクリプトをいい感じに修正してやると、フラグゲットです。\nfrom binascii import unhexlify from Crypto.Util.number import * def rthroot(c, r, q): c %= q assert(isPrime(r) and (q - 1) % r == 0 and (q - 1) % (r**2) != 0) l = ((q - 1) % (r**2)) // r alpha = (-inverse(l, r)) % r root = pow(c, ((1 + alpha * (q - 1) // r) // r), q) return root def allroot(r, q, root): all_root = set() all_root.add(root) while len(all_root) \u003c r: new_root = root unity = pow(getRandomRange(2, q), (q - 1) // r, q) for i in range(r - 1): new_root = (new_root * unity) % q all_root.add(new_root) return all_root def crt(ai, mi): a1, m1 = ai[0], mi[0] a2, m2 = ai[1], mi[1] return (a1 * inverse(m2, m1) * m2 + a2 * inverse(m1, m2) * m1) % (m1 * m2) def decrypt(proot, qroot, p, q): count = 0 total = len(proot) * len(qroot) t1 = inverse(q, p) t2 = inverse(p, q) for i in proot: for j in qroot: count += 1 root = (i, j) m = crt(root, (p, q)) m = (i * t1 * q + j * t2 * p) % (p * q) flag = long_to_bytes(m) if flag.startswith(b\"ctf\"): print('\\n', flag) def main(): p = 13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844727189 q = 13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844741541 n = 169221770188000341507764005330769042705223611712308424479120192596136318818708135716157255550936563268500310852894489839470320516645317338473018150885997977008925839939560590924435380239519554475266121835753044660177349444503693993991253475530436734034224314165897550185719665717183285653938232013807360458249 e = 17 c = 100233131931360278332734341652304555814094487252151131735286074616555402795190797647001889669472290770925839013131356212574455274690422113278015571750653365512998669453161955302008599029919101244702933443124944274359143831492874463245444294673660944786888148517110942002726017336219552279179125115273728023902 print('[+] Calculating e-th root...') proot = rthroot(c, e, p) #qroot = rthroot(c, e, q) print('[+] Calculating all e-th roots...') all_proot = allroot(e, p, proot) #all_qroot = allroot(e, q, qroot) d_ = inverse(e, q-1) all_qroot = {pow(c, d_, q)} print('[+] CRT cracking...') decrypt(all_proot, all_qroot, p, q) if __name__ == '__main__': main() ctf4b{4r3_y0u_up5id3_d0wn?_Fr0m_6310w?_0r_60th?}\n何もわからずに解いてるが、解ければOK\n想定解のカーマイケルの定理、全然頭になかったので、へ〜ってなりました。 手札が増えたので、とりあえずおけまろ水産🐟\nこれも30分前後で解いた気がする。 わかりません。 （書くのは詳細をだいぶ省いたのですぐ書けた、このくらいの気持ちで書いていかないと疲れちゃうよ〜、writeup書く人類全員えらすぎる）\n[crypto] Field_trip 次はこれを取り組んでいきました。\n配布ファイルを見た感じ、ソースコードcipherの生成はここでやっていることがわかります。\ncipher = sum([int(flag[i]) * pub_key[i] for i in range(length)]) output.txtにはpub_keyが入っていたので、LLLでよく見るやつやんけ！！と思ってsolverを書きます（ただ、このときはまだflag[i]が1byteだと思っている）。\nflag[i]を1bytesだと勘違いしているので、雑に書いたら全然違う値が出てきて？？？となりました。 てか、なんか行列のサイズでかくね？？ みたいな違和感から、もうちょっと問題ファイルを見ると、\nflag = bin(flag)[2:] がありました。ぴえん。早とちり早男と申します。\n完全にknapsack暗号ですね。 昔に同じような問題を解いていたので、前ブログの記事からsolverを引っ張り出してきます。 厳密には、密度によっては失敗するかもしれないですが、それでもまだ手札はあったのでとりあえずこのsolverで試してみます。\nfrom sage.all import * from binascii import unhexlify exec(open(\"output.txt\").read()) pk = pub_key c = cipher def create_matrix(c, pk): n = len(pk) i = matrix.identity(n) * 2 last_col = [-1]*n first_row = [] for p in pk: first_row.append(p) first_row.append(-c) m = matrix(ZZ, 1, n+1, first_row) m = 1000 * m bottom = i.augment(matrix(ZZ, n, 1, last_col)) m = m.stack(bottom) return m def find_short_vector(matrix): for col in matrix.columns(): if col[0] != 0: continue if is_short_vector(col): return col def is_short_vector(vector): for v in vector: if v != 1 and v != -1 and v != 0: return False return True m = create_matrix(c, pk) lllm = m.transpose().LLL().transpose() short_vector = find_short_vector(lllm) solution_vector = [] for v in short_vector: if v == 1: solution_vector.append(1) elif v == -1: solution_vector.append(0) m = \"\".join(map(str, solution_vector)) print(unhexlify(hex(int(m, 2))[2:])) .py“でsageを書くのにハマってる時代＆sageに外部パッケージを入れる方法を知らない時代のスクリプトで懐かしくなりました。 今はもう外部パッケージも使えますし、sageは.sageで書きますが、気にせずに実行します。\n$ sage knapsack.sage b'ctf4b{Y35!_I_ju5t_n33d3d_th353_num63r5!}' 💪 🚩 💪\n20分くらい？で解いた？わかんない\nここまで、解ければ後は消化試合という感じですね。 ラストスパートやっていきましょう。\n[crypto] GFM なんか行列がちゃがちゃしてるな〜という所感\nkeyとencはもらえてるっぽいので、これ普通に逆行列計算してやればMでるな〜とわかります。 あとは、Mをいろいろやっているところを見ていきます。\nM = copy(MS.zero()) for i in range(SIZE): for j in range(SIZE): n = i * SIZE + j if n \u003c len(FLAG): M[i, j] = FLAG[n] else: M[i, j] = GF(p).random_element() M行列の要素の初めの方はflagが1文字づつはいってることがわかります。 keyも逆行列を持つことが保証されているので、解けそう。 sageにいれたら、簡単に解けるでしょ〜〜と思ったら、output.txtの出力が空白くぎりで必殺技\"コピってペ\"ができないです。 これは試合終了かと思われましたが、yoshiking選手、なんとか持ちこたえて修正していきました。\np = 331941721759386740446055265418196301559 SIZE = 8 MS = MatrixSpace(GF(p), SIZE) key = [[116401981595413622233973439379928029316,198484395131713718904460590157431383741,210254590341158275155666088591861364763,63363928577909853981431532626692827712,85569529885869484584091358025414174710,149985744539791485007500878301645174953,257210132141810272397357205004383952828,184416684170101286497942970370929735721], [42252147300048722312776731465252376713,199389697784043521236349156255232274966,310381139154247583447362894923363190365,275829263070032604189578502497555966953,292320824376999192958281274988868304895,324921185626193898653263976562484937554,22686717162639254526255826052697393472,214359781769812072321753087702746129144], [211396100900282889480535670184972456058,210886344415694355400093466459574370742,186128182857385981551625460291114850318,13624871690241067814493032554025486106,255739890982289281987567847525614569368,134368979399364142708704178059411420318,277933069920652939075272826105665044075,61427573037868265485473537350981407215], [282725280056297471271813862105110111601, 183133899330619127259299349651040866360, 275965964963191627114681536924910494932,290264213613308908413657414549659883232,140491946080825343356483570739103790896,115945320124815235263392576250349309769,240154953119196334314982419578825033800, 33183533431462037262108359622963646719], [53797381941014407784987148858765520206, 136359308345749561387923094784792612816, 26225195574024986849888325702082920826,262047729451988373970843409716956598743,170482654414447157611638420335396499834,270894666257247100850080625998081047879, 91361079178051929124422796293638533509, 34320536938591553179352522156012709152], [266361407811039627958670918210300057324, 40603082064365173791090924799619398850, 253357188908081828561984991424432114534, 322939245175391203579369607678957356656, 63315415224740483660852444003806482951, 224451355249970249493628425010262408466, 80574507596932581147177946123110074284, 135660472191299636620089835364724566497],[147031054061160640084051220440591645233, 286143152686211719101923153591621514114, 330366815640573974797084150543488528130, 144943808947651161283902116225593922999, 205798118501774672701619077143286382731, 317326656225121941341827388220018201533, 14319175936916841467976601008623679266, 112709661623759566156255015500851204670],[306746575224464214911885995766809188593, 35156534122767743923667417474200538878, 35608800809152761271316580867239668942, 259728427797578488375863755690441758142, 29823482469997458858051644485250558639, 137507773879704381525141121774823729991, 29893063272339035080311541822496817623, 292327683738678589950939775184752636265]] enc = [[133156758362160693874249080602263044484, 293052519705504374237314478781574255411, 72149359944851514746901936133544542235, 56884023532130350649269153560305458687, 67693140194970657150958369664873936730, 227562364727203645742246559359263307899, 98490363636066788474326997841084979092, 323336812987530088571937131837711189774],[244725074927901230757605861090949184139, 63515536426726760809658259528128105864, 297175420762447340692787685976316634653, 279269959863745528135624660183844601533, 203893759503830977666718848163034645395, 163047775389856094351865609811169485260, 103694284536703795013187648629904551283, 322381436721457334707426033205713602738],[ 17450567396702585206498315474651164931, 105594468721844292976534833206893170749, 10757192948155933023940228740097574294, 132150825033376621961227714966632294973, 329990437240515073537637876706291805678, 57236499879418458740541896196911064438, 265417446675313880790999752931267955356, 73326674854571685938542290353559382428],[270340230065315856318168332917483593198, 217815152309418487303753027816544751231, 55738850736330060752843300854983855505, 236064119692146789532532278818003671413, 104963107909414684818161043267471013832, 234439803801976616706759524848279829319, 173296466130000392237506831379251781235, 34841816336429947760241770816424911200],[140341979141710030301381984850572416509, 248997512418753861458272855046627447638, 58382380514192982462591686716543036965, 188097853050327328682574670122723990784, 125356457137904871005571726686232857387, 55692122688357412528950240580072267902, 21322427002782861702906398261504812439, 97855599554699774346719832323235463339],[298368319184145017709393597751160602769, 311011298046021018241748692366798498529, 165888963658945943429480232453040964455, 240099237723525827201004876223575456211, 306939673050020405511805882694537774846, 7035607106089764511604627683661079229, 198278981512146990284619915272219052007, 255750707476361671578970680702422436637],[ 45315424384273600868106606292238082349, 22526147579041711876519945055798051695, 15778025992115319312591851693766890019, 318446611756066795522259881812628512448, 269954638404267367913546070681612869355, 205423708248276366495211174184786418791, 92563824983279921050396256326760929563, 209843107530597179583072730783030298674],[ 662653811932836620608984350667151180, 304181885849319274230319044357612000272, 280045476178732891877948766225904840517, 216340293591880460916317821948025035163, 79726526647684009633247003110463447210, 36010610538790393011235704307570914178, 284067290617158853279270464803256026349, 45816877317461535723616457939953776625]] C = matrix(enc) K = matrix(key) inv_K = K.inverse() M = inv_K * C * inv_K print([bytes([i%p]) for i in list(M)[0]]) flag = b\"\" for row in list(M): for x in list(row): x = x % p if 0 \u003c= x \u003c= 255: flag += bytes([x]) else: flag += b\"?\" print(flag) ctf4b{d1d_y0u_pl4y_w1th_m4tr1x_4nd_g4l0is_f1eld?}\n出力形式がぴえんこえてぱおん🐘\n[crypto] Logical_SEESAW 複数回、同じ鍵でflagとandを取っていることがわかります。 andなので、flagがもともの0の箇所は鍵が何であれ0になります。 また、flagが1の場合は、鍵が0の場合は出力が2通りになり、鍵が1の場合は確率によらす1となります。\nこれを使えば、解けそうです （なんか普通のwriteupになってきましたね、非常に疲れてきました、あと簡単な問題は試行錯誤もないので…許してください…）\nimport collections exec(open(\"output.txt\").read()) length = len(cipher[0]) flag = \"\" for i in range(length): bits = [c[i] for c in cipher] cnt = collections.Counter(bits) if len(cnt) == 2: flag += \"1\" else: flag += cnt.most_common()[0][0] flag = int(flag, 2) print(bytes.fromhex(hex(flag)[2:])) ctf4b{Sh3_54w_4_SEESAW,_5h3_54id_50}\n[crypto] simple_RSA のこりcrypto一問です、最後の有終の美を飾るのはsimpleなRSA問題でした。\nビット長からわかるように、flagをe乗してもnより大きくなっていなさそうです。 square rootを取れば終わりです！\nOK!sagemath!\n$ sage ┌────────────────────────────────────────────────────────────────────┐ │ SageMath version 9.2, Release Date: 2020-10-24 │ │ Using Python 3.8.5. Type \"help()\" for help. │ └────────────────────────────────────────────────────────────────────┘ sage: n = 1768667184240039357473051203420012852133691956973597279167660505628677847323071842695850887894263158470481734230495929306050761407480055367057903339967904133486315690203093489519767754314220211 ....: 07816294944514533513969621373774114778994925558309827014496925615941751626235809874531513284088501164540581623702737363560683196485671055124528937368669392002970716029942882582952317511179914081605 ....: 69998347640357251625243671483903597718500241970108698224998200840245865354411520826506950733058870602392209113565367230443261205476636664049066621093558272244061778795051583920491406620090704660526 ....: 753969180791952189324046618283 ....: e = 3 ....: c = 2137917515300171115086910841683630246868780573379713198802569241853937371507043427250428414885473159259719603892304533323193718760929680325131490239762871586989902516402983608765893308108131992 ....: 60879441426084508864252450551111064068694725939412142626401778628362399359107132506177231354040057205570428678822068599327926328920350319336256613 ....: output.txtからパラメータペっとして、nth_root()を使えば…\nsage: m = c.nth_root(e) sage: bytes.fromhex(hex(m)[2:]) b\"ctf4b{0,1,10,11...It's_so_annoying.___I'm_done}\" うお〜〜〜〜終わった！！！！！\nRTA: 約2h00m00s 正確なタイムはわかりませんが、16:00にはツイートしてたので、2時間かからないぐらいでしょうか。\nたぶんこの記事を書くほうが時間かかっています。 完全にImaginaryで燃え尽きていますね。 なんでこんな記事書いてるんだろって何度も思いました。\nおわりに やっべ〜〜、魔女のお茶会に遅刻する〜〜〜\n","wordCount":"1262","inLanguage":"ja","datePublished":"2021-05-23T15:10:29+09:00","dateModified":"2021-05-23T15:10:29+09:00","author":{"@type":"Person","name":"yoshiking"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://y05h1k1ng.github.io/posts/seccon-beginners-2021/"},"publisher":{"@type":"Organization","name":"yoshikingのへや","logo":{"@type":"ImageObject","url":"https://y05h1k1ng.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://y05h1k1ng.github.io/ accesskey=h title="yoshikingのへや (Alt + H)">yoshikingのへや</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://y05h1k1ng.github.io/en/ title=English aria-label=English>English</a></li></ul></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://y05h1k1ng.github.io/about.html title=About><span>About</span></a></li><li><a href=https://y05h1k1ng.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://y05h1k1ng.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://y05h1k1ng.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://y05h1k1ng.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://y05h1k1ng.github.io/posts/>Posts</a></div><h1 class=post-title>SECCON Beginners CTF 2021 参加記</h1><div class=post-meta>May 23, 2021&nbsp;·&nbsp;6 分&nbsp;·&nbsp;yoshiking</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>目次</div></summary><div class=inner><ul><li><a href=#%e3%81%af%e3%81%98%e3%82%81%e3%81%ab aria-label=はじめに>はじめに</a></li><li><a href=#%e9%96%8b%e5%a7%8b%e5%89%8d aria-label=開始前>開始前</a></li><li><a href=#%e3%81%af%e3%81%98%e3%81%be%e3%82%8a%e3%81%af%e3%81%98%e3%81%be%e3%82%8a aria-label=はじまりはじまり〜🎉>はじまりはじまり〜🎉</a><ul><li><a href=#crypto-imaginary aria-label="[crypto] Imaginary">[crypto] Imaginary</a></li><li><a href=#crypto-p-8rsa aria-label="[crypto] p-8RSA">[crypto] p-8RSA</a></li><li><a href=#crypto-field_trip aria-label="[crypto] Field_trip">[crypto] Field_trip</a></li><li><a href=#crypto-gfm aria-label="[crypto] GFM">[crypto] GFM</a></li><li><a href=#crypto-logical_seesaw aria-label="[crypto] Logical_SEESAW">[crypto] Logical_SEESAW</a></li><li><a href=#crypto-simple_rsa aria-label="[crypto] simple_RSA">[crypto] simple_RSA</a></li></ul></li><li><a href=#rta-%e7%b4%842h00m00s aria-label="RTA: 約2h00m00s">RTA: 約2h00m00s</a></li><li><a href=#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab aria-label=おわりに>おわりに</a></li></ul></div></details></div><div class=post-content><blockquote><p>⚠️ <del>Wrteupではなく"参加記"です。読み物としてご覧ください。</del>
書いてみたらそんなことはないかも、いやそうかも？わかんない</p></blockquote><h2 id=はじめに>はじめに<a hidden class=anchor aria-hidden=true href=#はじめに>#</a></h2><p>一人チーム(<code>UdagawaWhiteBears</code>)で出て、42位2602点でした。
内訳としては、cryptoとrevは全部解き、他ジャンルは簡単な問題をいくつか解きました。</p><p>普通にwriteup書いてもな〜(なんで?)となったので、今回はどのような流れでcryptoを解いていったのか流れを書いていこうと思います。
なんでこんなことをやりだしたかというと、<a href=https://twitter.com/pwnyaa>ptr-yudai</a>が書いた<a href=https://ptr-yudai.hatenablog.com/entry/2021/05/17/233613>TSG LIVE ! 6 CTFのWriteup</a>が面白かったからです。
あとは、数式を書くのが面倒だからです（ぶっちゃけ）。</p><p>作問者writeupも出ていますし、SECCON Beginnersなので日本人の参加者は多いと思うので、詳細は他の人が書いてくれるでしょうと信じています。
あと、全然理解せずにこいつ解いてるんだな〜みたいな様子が伝わればいいなと思います😇</p><h2 id=開始前>開始前<a hidden class=anchor aria-hidden=true href=#開始前>#</a></h2><p>16:00から開始だと思ってたら14:00からで、ちょっと焦った記憶があります（遅刻はしてないけど）。
pwnerと違ってcrytpoでは特に準備することがありません。
わくわくしておけば💯だと思います。</p><p>真面目な話をすると、先述のptr-yudaiの記事ではpythonとsageをまず実行しておくと次に起動するときに早くなるらしいですが、全然知らなかったしやってないです。
まあ誤差でしょう()</p><p>戦略的にはcrypto全部解きたいな〜ぐらいに考えていて、beginner向けなので、難しい問題から手をつけていこうと思っていました。</p><h2 id=はじまりはじまり>はじまりはじまり〜🎉<a hidden class=anchor aria-hidden=true href=#はじまりはじまり>#</a></h2><p>14:00! はじまり〜〜、わくわくしすぎてワクワクさんになりました。</p><p>早速、問題に取り掛かろうと思うのですが、ファイルのダウンロードができません😢
問題サーバーは生きてるので、ncする問題(Imaginary)があったのでこれを見てみることにしました（難しい問題からやる？そんなことはとうの昔に忘れました）。</p><h3 id=crypto-imaginary>[crypto] Imaginary<a hidden class=anchor aria-hidden=true href=#crypto-imaginary>#</a></h3><p>接続した感じと問題文で、わぁ〜なんか虚数じゃん、ツラと思います。</p><pre tabindex=0><code>$ nc imaginary.quals.beginners.seccon.jp 1337
Welcome to Secret IMAGINARY NUMBER Store!
1. Save a number
2. Show numbers
3. Import numbers
4. Export numbers
0. Exit
&gt;
</code></pre><p>べそをかいていると、ファイルのダウンロードができるようになりました。
さすがLMT、30秒もかかってないんじゃないでしょうか（適当）。</p><p>ファイルを見ていきます。</p><p>うえ〜〜、100行以上あるじゃん、ぴえんです。
CTFというのはフラグと呼ばれる文字列を見つけるゲームなので、とりあえず<code>Ctrl + s</code>で<code>flag</code>を探してみます(emacs user)。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_secret</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;1337i&#39;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>numbers:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Congratulations!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;The flag is </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>encode())
</span></span></code></pre></div><p>いますね。
<code>self.numbers</code>に<code>1337i</code>が含まれていればOKっぽいです。
あとは<code>_secret(self)</code>を呼んでいる箇所を探します。
<code>Ctrl + s</code>で(略)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> num <span style=color:#f92672>==</span> <span style=color:#ae81ff>5</span>:
</span></span><span style=display:flex><span>                    self<span style=color:#f92672>.</span>_secret()
</span></span></code></pre></div><p>？？？、おまっ？どこから湧いてきたんや！？</p><p>失礼、近所の関西弁のおじさんが出てきてしまいましたが、気にせずにいきましょう。</p><p>接続した際にはいなかった、選択肢がありましたね。
とりあえず、この辺で<code>flag</code>を得る道筋がすこし見えてきました。
今わかっている限りでは、<code>self.numbers</code>に<code>1337i</code>を<code>save</code>とかで含めて、<code>5</code>を呼べば良さそうです。</p><p>とりあえず、<code>self.numbers</code>に値を入れたいので、<code>_save()</code>を見に行きます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_save</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Real part&gt; &#39;</span>)
</span></span><span style=display:flex><span>            re <span style=color:#f92672>=</span> int(self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>128</span>)<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Imaginary part&gt; &#39;</span>)
</span></span><span style=display:flex><span>            im <span style=color:#f92672>=</span> int(self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>128</span>)<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            name <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>re<span style=color:#e6db74>}</span><span style=color:#e6db74> + </span><span style=color:#e6db74>{</span>im<span style=color:#e6db74>}</span><span style=color:#e6db74>i&#39;</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>numbers[name] <span style=color:#f92672>=</span> [re, im]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><p>なんのcheckも入っていません。
てか、<code>self.numbers</code>が配列かな〜と勝手に推測していたのですが、dictです。
え？これ入れるだけでは？と思って試してみます。</p><pre tabindex=0><code>$ nc imaginary.quals.beginners.seccon.jp 1337
Welcome to Secret IMAGINARY NUMBER Store!
1. Save a number
2. Show numbers
3. Import numbers
4. Export numbers
0. Exit
&gt; 1
Real part&gt; 0
Imaginary part&gt; 1337
1. Save a number
2. Show numbers
3. Import numbers
4. Export numbers
0. Exit
&gt; 2
--------------------------------------------------
0 + 1337i: (0, 1337)
--------------------------------------------------
</code></pre><p>う、なるほど、<code>0</code>が入るのね〜とわかります。</p><p>ここで、これpythonで <code>hoge in dict</code>って、比較されるのkey?value?と思って確認します。</p><pre tabindex=0><code class=language-python-console data-lang=python-console>$ python3
Python 3.8.5 (default, Jan 27 2021, 15:41:15)
[GCC 9.3.0] on linux
Type &#34;help&#34;, &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.
&gt;&gt;&gt; a = {&#34;x&#34;: 1}
&gt;&gt;&gt; &#34;x&#34; in a
True
&gt;&gt;&gt; 1 in a
False
&gt;&gt;&gt;
</code></pre><p>御意。
さっきやった実験では、<code>0 + 1337i</code>がkeyに入っているので、これではダメそうです。</p><p>まだ、<code>_save()</code>を見ただけなので、もう一つ値を入れれそうな<code>_import()</code>を見ます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_import</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Exported String&gt; &#39;</span>)
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>        enc <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(data)
</span></span><span style=display:flex><span>        cipher <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>        plaintext <span style=color:#f92672>=</span> unpad(cipher<span style=color:#f92672>.</span>decrypt(enc), AES<span style=color:#f92672>.</span>block_size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>numbers <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(plaintext<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Imported.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_show()
</span></span></code></pre></div><p><code>AES</code>の文字がちらつきます。
cryptoになってきました。
虚数から数学問の可能性がありましたが、そうではなさそうです。
与えた文字列を<code>AES</code>の<code>ECB</code>モードで復号してから、<code>self.number</code>に<code>json.dump</code>したものを代入しています。
<code>ECB</code>モードなので、まぁ、なんかできるでしょう！という気持ちになります。</p><p>残るは<code>_export</code>を見ていきます（<code>_show()</code>には申し訳ないが、スルーさせてもらう）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_export</span>(self):
</span></span><span style=display:flex><span>        cipher <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>        dump <span style=color:#f92672>=</span> pad(json<span style=color:#f92672>.</span>dumps(self<span style=color:#f92672>.</span>numbers)<span style=color:#f92672>.</span>encode(), AES<span style=color:#f92672>.</span>block_size)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(dump <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        enc <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>encrypt(dump)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;Exported:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>sendall(enc<span style=color:#f92672>.</span>hex()<span style=color:#f92672>.</span>encode() <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span></code></pre></div><p>こちらも、特に変わったことはしてなくて、<code>self.number</code>を文字列にして暗号化したものがもらえます。</p><p>ここで、<code>ECB</code>モードなので、&ldquo;いい感じ"にブロックを分けて作ってから、がっちゃんこすればOKみたいな方針が立ちます。<code>ECB</code>モードだと、基本的には同じ平文は同じ暗号文になることを使いがちムーブをしていきます。</p><p>さて、どうやるといい感じになるかな〜と手元で試してみます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> json <span style=color:#f92672>import</span> dumps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>gen_blocks</span>(s):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [s[i:i<span style=color:#f92672>+</span><span style=color:#ae81ff>16</span>] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(s), <span style=color:#ae81ff>16</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;-100 + 1000i&#34;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>1000</span>], <span style=color:#e6db74>&#34;0 + 1337i&#34;</span>: [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1337</span>]}
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> dumps(x)
</span></span><span style=display:flex><span>blocks <span style=color:#f92672>=</span> gen_blocks(s)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> block <span style=color:#f92672>in</span> blocks:
</span></span><span style=display:flex><span>    print(block)
</span></span></code></pre></div><pre tabindex=0><code>$ python3 test.py
{&#34;-100 + 1000i&#34;:
 [-100, 1000], &#34;
0 + 1337i&#34;: [0,
1337]}
</code></pre><p>なんで、マイナスとかつけちゃってるの？という気もしますが、つけたい気分だったんでしょう。
わかりません。</p><p><code>...], "</code>と<code>1337i":...</code>をがっちゃんこすれば<code>...],　"1337i":...</code>となり、良さそうですね。
あとは、<code>1337i":...</code>から始まるブロックを調整して作って、後ろの2ブロックを使えば、念願のフラグゲットです。</p><p><code>save</code>で、<code>{"-100 + 1000i": [-100, 1000], "0 + 1337i": [0, 1337]}</code>となるように値を入れます。
これを、<code>export</code>して前の2ブロックを使います。
一度、接続を切ってから、次は<code>x = {"10 + 1000i": [10, 1000], "0 + 1337i": [0, 1337]}</code>となるように<code>save</code>していきます。
また、<code>export</code>して次は後ろの2ブロックを使って、前の2ブロックと今回の後ろ2ブロックをつなげたhex値を<code>import</code>します。
これで隠し選択肢<code>5</code>を選択すれば、フラグゲットです🚩</p><p><code>ctf4b{yeah_you_are_a_member_of_imaginary_number_club}</code></p><p>たぶん、30分前後で解けたと思います。
記憶が正しければfirst bloodを頂いていたはずですが、今回のスコアサーバーでは解いた問題の情報が見れないので真相は闇の中&mldr;</p><p>ここまで書いてきましたが、普通にWriteupを書くより大変ということに気づいて泣いています。
解法の詳細は他の人に譲って、考えてることを軽く書こうとしてたら、試行錯誤付きのwriteupになってしまって大変疲労しています。
ここからは、解法の詳細は他の人、と復唱しながら書いていきます。</p><h3 id=crypto-p-8rsa>[crypto] p-8RSA<a hidden class=anchor aria-hidden=true href=#crypto-p-8rsa>#</a></h3><p>気を取り直して、次こそは一番むずかしい問題に取り組みます。</p><p>ファイルを落としてきます。
問題名からRSAであることは自明ですが、簡単な問題であることを祈ります🙏</p><p>ばっと見た感じ暗号化は普通のRSAで、素数の生成が特殊なようです。
<code>q</code>を生成した後、<code>p</code>の生成は<code>q</code>から8を引いていって素数になるまで回してそうです。</p><p>お！これは<code>p</code>と<code>q</code>の差がそこまでなさそうという気持ちになるので、fermat法とかで素因数分解できそうです。
fermat法のスクリプトもってねーと思ったので、google先生に<code>sage fermat factorization</code>と聞いてみると、いい感じのコードが乗っている<a href=https://facthacks.cr.yp.to/fermat.html>サイト</a>を見つけました。
コピって、ペってします。</p><pre tabindex=0><code class=language-python-console data-lang=python-console>yoshiking@yoshiking-vm:~/ctf/seccon_begginers/p-8RSA$ sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.2, Release Date: 2020-10-24                     │
│ Using Python 3.8.5. Type &#34;help()&#34; for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage: n = 1692217701880003415077640053307690427052236117123084244791201925961363188187081357161572555509365632685003108528944898394703205166453173384730181508859979770089258399395605909244353802395195544
....: 75266121835753044660177349444503693993991253475530436734034224314165897550185719665717183285653938232013807360458249
....: e = 17
....: c = 1002331319313602783327343416523045558140944872521511317352860746165554027951907976470018896694722907709258390131313562125744552746904221132780155717506533655129986694531619553020085990299191012
....: 44702933443124944274359143831492874463245444294673660944786888148517110942002726017336219552279179125115273728023902
....:
sage: def fermatfactor(N):
....:        if N &lt;= 0: return [N]
....:        if is_even(N): return [2,N/2]
....:        a = ceil(sqrt(N))
....:        while not is_square(a^2-N):
....:          a = a + 1
....:        b = sqrt(a^2-N)
....:        return [a - b,a + b]
....:
sage: fermatfactor(n)
[13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844727189,
 13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844741541]
</code></pre><p>わいわい</p><p>できてそうですね。
あとは、復号するだけじゃん〜〜と思っていたんですが、素数生成時に<code>p</code>が素数になるまでと他にも条件がありました&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#66d9ef>if</span> isPrime(p) <span style=color:#f92672>and</span> GCD(phi, e) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span></code></pre></div><p><code>GCD(phi, e) != 1</code>はツラ</p><p>といっても、よくあることなのでがんばります。</p><p>片方の素数は $(p-1)\nmid e$だったので、<code>p</code>でニセ<code>d</code>作って復号できんじゃね？と思ったら、しっかりとパディングされていました。ぴえん。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>flag <span style=color:#f92672>=</span> flag<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;utf-8&#34;</span>) <span style=color:#f92672>+</span> urandom(<span style=color:#ae81ff>64</span>)
</span></span></code></pre></div><p>のこる手札は、<code>GCD(phi, e)</code>で割ってやる方法ですが、これも<code>GCD(phi, e) = 17</code>なので、ぴえんこえてぱおん。</p><p>もう手札0だよ〜〜ぴえんぴえんとしていると、ある記事を思い出します(bookmarkにあった)。</p><p>中国語の記事だけど、よくまとまってると思います。
<a href=https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/>https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/</a></p><p>ここに乗ってなかったかな〜と思うと、ありました！！
ばんざい🙌</p><p>ここでもコピってペっとすればOKと言いたいところですが、記事に乗っている方法は$(p-1) | e$ <strong>かつ</strong> $(q-1) | e$なので少々オーバーキルです。
そのあたりのスクリプトをいい感じに修正してやると、フラグゲットです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> binascii <span style=color:#f92672>import</span> unhexlify
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rthroot</span>(c, r, q):
</span></span><span style=display:flex><span>    c <span style=color:#f92672>%=</span> q
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span>(isPrime(r) <span style=color:#f92672>and</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> r <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> (r<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    l <span style=color:#f92672>=</span> ((q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> (r<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>)) <span style=color:#f92672>//</span> r
</span></span><span style=display:flex><span>    alpha <span style=color:#f92672>=</span> (<span style=color:#f92672>-</span>inverse(l, r)) <span style=color:#f92672>%</span> r
</span></span><span style=display:flex><span>    root <span style=color:#f92672>=</span> pow(c, ((<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> alpha <span style=color:#f92672>*</span> (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>//</span> r) <span style=color:#f92672>//</span> r), q)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> root
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>allroot</span>(r, q, root):
</span></span><span style=display:flex><span>    all_root <span style=color:#f92672>=</span> set()
</span></span><span style=display:flex><span>    all_root<span style=color:#f92672>.</span>add(root)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> len(all_root) <span style=color:#f92672>&lt;</span> r:
</span></span><span style=display:flex><span>        new_root <span style=color:#f92672>=</span> root
</span></span><span style=display:flex><span>        unity <span style=color:#f92672>=</span> pow(getRandomRange(<span style=color:#ae81ff>2</span>, q), (q <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>//</span> r, q)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(r <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>            new_root <span style=color:#f92672>=</span> (new_root <span style=color:#f92672>*</span> unity) <span style=color:#f92672>%</span> q
</span></span><span style=display:flex><span>            all_root<span style=color:#f92672>.</span>add(new_root)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> all_root
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>crt</span>(ai, mi):
</span></span><span style=display:flex><span>    a1, m1 <span style=color:#f92672>=</span> ai[<span style=color:#ae81ff>0</span>], mi[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    a2, m2 <span style=color:#f92672>=</span> ai[<span style=color:#ae81ff>1</span>], mi[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (a1 <span style=color:#f92672>*</span> inverse(m2, m1) <span style=color:#f92672>*</span> m2 <span style=color:#f92672>+</span> a2 <span style=color:#f92672>*</span> inverse(m1, m2) <span style=color:#f92672>*</span> m1) <span style=color:#f92672>%</span> (m1 <span style=color:#f92672>*</span> m2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decrypt</span>(proot, qroot, p, q):
</span></span><span style=display:flex><span>    count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    total <span style=color:#f92672>=</span> len(proot) <span style=color:#f92672>*</span> len(qroot)
</span></span><span style=display:flex><span>    t1 <span style=color:#f92672>=</span> inverse(q, p)
</span></span><span style=display:flex><span>    t2 <span style=color:#f92672>=</span> inverse(p, q)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> proot:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> qroot:
</span></span><span style=display:flex><span>            count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            root <span style=color:#f92672>=</span> (i, j)
</span></span><span style=display:flex><span>            m <span style=color:#f92672>=</span> crt(root, (p, q))
</span></span><span style=display:flex><span>            m <span style=color:#f92672>=</span> (i <span style=color:#f92672>*</span> t1 <span style=color:#f92672>*</span> q <span style=color:#f92672>+</span> j <span style=color:#f92672>*</span> t2 <span style=color:#f92672>*</span> p) <span style=color:#f92672>%</span> (p <span style=color:#f92672>*</span> q)
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>=</span> long_to_bytes(m)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> flag<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;ctf&#34;</span>):
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>, flag)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    p <span style=color:#f92672>=</span> <span style=color:#ae81ff>13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844727189</span>
</span></span><span style=display:flex><span>    q <span style=color:#f92672>=</span> <span style=color:#ae81ff>13008526826201356667891590694678121516071641430494347349438757349219893000439927852950504383765791466428599814640460028507882213264934492728368742844741541</span>
</span></span><span style=display:flex><span>    n <span style=color:#f92672>=</span> <span style=color:#ae81ff>169221770188000341507764005330769042705223611712308424479120192596136318818708135716157255550936563268500310852894489839470320516645317338473018150885997977008925839939560590924435380239519554475266121835753044660177349444503693993991253475530436734034224314165897550185719665717183285653938232013807360458249</span>
</span></span><span style=display:flex><span>    e <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>
</span></span><span style=display:flex><span>    c <span style=color:#f92672>=</span> <span style=color:#ae81ff>100233131931360278332734341652304555814094487252151131735286074616555402795190797647001889669472290770925839013131356212574455274690422113278015571750653365512998669453161955302008599029919101244702933443124944274359143831492874463245444294673660944786888148517110942002726017336219552279179125115273728023902</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;[+] Calculating e-th root...&#39;</span>)
</span></span><span style=display:flex><span>    proot <span style=color:#f92672>=</span> rthroot(c, e, p)
</span></span><span style=display:flex><span>    <span style=color:#75715e>#qroot = rthroot(c, e, q)</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;[+] Calculating all e-th roots...&#39;</span>)
</span></span><span style=display:flex><span>    all_proot <span style=color:#f92672>=</span> allroot(e, p, proot)
</span></span><span style=display:flex><span>    <span style=color:#75715e>#all_qroot = allroot(e, q, qroot)</span>
</span></span><span style=display:flex><span>    d_ <span style=color:#f92672>=</span> inverse(e, q<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    all_qroot <span style=color:#f92672>=</span> {pow(c, d_, q)}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;[+] CRT cracking...&#39;</span>)
</span></span><span style=display:flex><span>    decrypt(all_proot, all_qroot, p, q)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p><code>ctf4b{4r3_y0u_up5id3_d0wn?_Fr0m_6310w?_0r_60th?}</code></p><p>何もわからずに解いてるが、解ければOK</p><p>想定解のカーマイケルの定理、全然頭になかったので、へ〜ってなりました。
手札が増えたので、とりあえずおけまろ水産🐟</p><p>これも30分前後で解いた気がする。
わかりません。
（書くのは詳細をだいぶ省いたのですぐ書けた、このくらいの気持ちで書いていかないと疲れちゃうよ〜、writeup書く人類全員えらすぎる）</p><h3 id=crypto-field_trip>[crypto] Field_trip<a hidden class=anchor aria-hidden=true href=#crypto-field_trip>#</a></h3><p>次はこれを取り組んでいきました。</p><p>配布ファイルを見た感じ、ソースコード<code>cipher</code>の生成はここでやっていることがわかります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>cipher <span style=color:#f92672>=</span> sum([int(flag[i]) <span style=color:#f92672>*</span> pub_key[i] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(length)])
</span></span></code></pre></div><p><code>output.txt</code>には<code>pub_key</code>が入っていたので、LLLでよく見るやつやんけ！！と思ってsolverを書きます（ただ、このときはまだ<code>flag[i]</code>が1byteだと思っている）。</p><p><code>flag[i]</code>を1bytesだと勘違いしているので、雑に書いたら全然違う値が出てきて？？？となりました。
てか、なんか行列のサイズでかくね？？
みたいな違和感から、もうちょっと問題ファイルを見ると、</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>flag <span style=color:#f92672>=</span> bin(flag)[<span style=color:#ae81ff>2</span>:]
</span></span></code></pre></div><p>がありました。ぴえん。早とちり早男と申します。</p><p>完全にknapsack暗号ですね。
昔に同じような問題を解いていたので、<a href=https://yoshiking.hatenablog.jp/entry/2020/01/26/205826#Crypto-200pts-knapsack>前ブログの記事</a>からsolverを引っ張り出してきます。
厳密には、密度によっては失敗するかもしれないですが、それでもまだ手札はあったのでとりあえずこのsolverで試してみます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> sage.all <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> binascii <span style=color:#f92672>import</span> unhexlify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exec(open(<span style=color:#e6db74>&#34;output.txt&#34;</span>)<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>pk <span style=color:#f92672>=</span> pub_key
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> cipher
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_matrix</span>(c, pk):
</span></span><span style=display:flex><span>    n <span style=color:#f92672>=</span> len(pk)
</span></span><span style=display:flex><span>    i <span style=color:#f92672>=</span> matrix<span style=color:#f92672>.</span>identity(n) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    last_col <span style=color:#f92672>=</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>*</span>n
</span></span><span style=display:flex><span>    first_row <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> p <span style=color:#f92672>in</span> pk:
</span></span><span style=display:flex><span>        first_row<span style=color:#f92672>.</span>append(p)
</span></span><span style=display:flex><span>    first_row<span style=color:#f92672>.</span>append(<span style=color:#f92672>-</span>c)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> matrix(ZZ, <span style=color:#ae81ff>1</span>, n<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, first_row)
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>*</span> m
</span></span><span style=display:flex><span>    bottom <span style=color:#f92672>=</span> i<span style=color:#f92672>.</span>augment(matrix(ZZ, n, <span style=color:#ae81ff>1</span>, last_col))
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>stack(bottom)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_short_vector</span>(matrix):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> col <span style=color:#f92672>in</span> matrix<span style=color:#f92672>.</span>columns():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> col[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_short_vector(col):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> col
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_short_vector</span>(vector):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> vector:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> v <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>and</span> v <span style=color:#f92672>!=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>and</span> v <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> create_matrix(c, pk)
</span></span><span style=display:flex><span>lllm <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>transpose()<span style=color:#f92672>.</span>LLL()<span style=color:#f92672>.</span>transpose()
</span></span><span style=display:flex><span>short_vector <span style=color:#f92672>=</span> find_short_vector(lllm)
</span></span><span style=display:flex><span>solution_vector <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> short_vector:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> v <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        solution_vector<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> v <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        solution_vector<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(map(str, solution_vector))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(unhexlify(hex(int(m, <span style=color:#ae81ff>2</span>))[<span style=color:#ae81ff>2</span>:]))
</span></span></code></pre></div><p><code>.py</code>&ldquo;でsageを書くのにハマってる時代＆sageに外部パッケージを入れる方法を知らない時代のスクリプトで懐かしくなりました。
今はもう外部パッケージも使えますし、sageは<code>.sage</code>で書きますが、気にせずに実行します。</p><pre tabindex=0><code>$ sage knapsack.sage
b&#39;ctf4b{Y35!_I_ju5t_n33d3d_th353_num63r5!}&#39;
</code></pre><p>💪 🚩 💪</p><p>20分くらい？で解いた？わかんない</p><p>ここまで、解ければ後は消化試合という感じですね。
ラストスパートやっていきましょう。</p><h3 id=crypto-gfm>[crypto] GFM<a hidden class=anchor aria-hidden=true href=#crypto-gfm>#</a></h3><p>なんか行列がちゃがちゃしてるな〜という所感</p><p><code>key</code>と<code>enc</code>はもらえてるっぽいので、これ普通に逆行列計算してやれば<code>M</code>でるな〜とわかります。
あとは、<code>M</code>をいろいろやっているところを見ていきます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>M <span style=color:#f92672>=</span> copy(MS<span style=color:#f92672>.</span>zero())
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(SIZE):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(SIZE):
</span></span><span style=display:flex><span>        n <span style=color:#f92672>=</span> i <span style=color:#f92672>*</span> SIZE <span style=color:#f92672>+</span> j
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> n <span style=color:#f92672>&lt;</span> len(FLAG):
</span></span><span style=display:flex><span>            M[i, j] <span style=color:#f92672>=</span> FLAG[n]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            M[i, j] <span style=color:#f92672>=</span> GF(p)<span style=color:#f92672>.</span>random_element()
</span></span></code></pre></div><p><code>M</code>行列の要素の初めの方は<code>flag</code>が1文字づつはいってることがわかります。
<code>key</code>も逆行列を持つことが保証されているので、解けそう。
sageにいれたら、簡単に解けるでしょ〜〜と思ったら、<code>output.txt</code>の出力が空白くぎりで必殺技"コピってペ"ができないです。
これは試合終了かと思われましたが、yoshiking選手、なんとか持ちこたえて修正していきました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>331941721759386740446055265418196301559</span>
</span></span><span style=display:flex><span>SIZE <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MS <span style=color:#f92672>=</span> MatrixSpace(GF(p), SIZE)
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span>  [[<span style=color:#ae81ff>116401981595413622233973439379928029316</span>,<span style=color:#ae81ff>198484395131713718904460590157431383741</span>,<span style=color:#ae81ff>210254590341158275155666088591861364763</span>,<span style=color:#ae81ff>63363928577909853981431532626692827712</span>,<span style=color:#ae81ff>85569529885869484584091358025414174710</span>,<span style=color:#ae81ff>149985744539791485007500878301645174953</span>,<span style=color:#ae81ff>257210132141810272397357205004383952828</span>,<span style=color:#ae81ff>184416684170101286497942970370929735721</span>], [<span style=color:#ae81ff>42252147300048722312776731465252376713</span>,<span style=color:#ae81ff>199389697784043521236349156255232274966</span>,<span style=color:#ae81ff>310381139154247583447362894923363190365</span>,<span style=color:#ae81ff>275829263070032604189578502497555966953</span>,<span style=color:#ae81ff>292320824376999192958281274988868304895</span>,<span style=color:#ae81ff>324921185626193898653263976562484937554</span>,<span style=color:#ae81ff>22686717162639254526255826052697393472</span>,<span style=color:#ae81ff>214359781769812072321753087702746129144</span>], [<span style=color:#ae81ff>211396100900282889480535670184972456058</span>,<span style=color:#ae81ff>210886344415694355400093466459574370742</span>,<span style=color:#ae81ff>186128182857385981551625460291114850318</span>,<span style=color:#ae81ff>13624871690241067814493032554025486106</span>,<span style=color:#ae81ff>255739890982289281987567847525614569368</span>,<span style=color:#ae81ff>134368979399364142708704178059411420318</span>,<span style=color:#ae81ff>277933069920652939075272826105665044075</span>,<span style=color:#ae81ff>61427573037868265485473537350981407215</span>], [<span style=color:#ae81ff>282725280056297471271813862105110111601</span>, <span style=color:#ae81ff>183133899330619127259299349651040866360</span>, <span style=color:#ae81ff>275965964963191627114681536924910494932</span>,<span style=color:#ae81ff>290264213613308908413657414549659883232</span>,<span style=color:#ae81ff>140491946080825343356483570739103790896</span>,<span style=color:#ae81ff>115945320124815235263392576250349309769</span>,<span style=color:#ae81ff>240154953119196334314982419578825033800</span>, <span style=color:#ae81ff>33183533431462037262108359622963646719</span>], [<span style=color:#ae81ff>53797381941014407784987148858765520206</span>, <span style=color:#ae81ff>136359308345749561387923094784792612816</span>, <span style=color:#ae81ff>26225195574024986849888325702082920826</span>,<span style=color:#ae81ff>262047729451988373970843409716956598743</span>,<span style=color:#ae81ff>170482654414447157611638420335396499834</span>,<span style=color:#ae81ff>270894666257247100850080625998081047879</span>, <span style=color:#ae81ff>91361079178051929124422796293638533509</span>, <span style=color:#ae81ff>34320536938591553179352522156012709152</span>], [<span style=color:#ae81ff>266361407811039627958670918210300057324</span>, <span style=color:#ae81ff>40603082064365173791090924799619398850</span>, <span style=color:#ae81ff>253357188908081828561984991424432114534</span>, <span style=color:#ae81ff>322939245175391203579369607678957356656</span>, <span style=color:#ae81ff>63315415224740483660852444003806482951</span>, <span style=color:#ae81ff>224451355249970249493628425010262408466</span>, <span style=color:#ae81ff>80574507596932581147177946123110074284</span>, <span style=color:#ae81ff>135660472191299636620089835364724566497</span>],[<span style=color:#ae81ff>147031054061160640084051220440591645233</span>, <span style=color:#ae81ff>286143152686211719101923153591621514114</span>, <span style=color:#ae81ff>330366815640573974797084150543488528130</span>, <span style=color:#ae81ff>144943808947651161283902116225593922999</span>, <span style=color:#ae81ff>205798118501774672701619077143286382731</span>, <span style=color:#ae81ff>317326656225121941341827388220018201533</span>,  <span style=color:#ae81ff>14319175936916841467976601008623679266</span>, <span style=color:#ae81ff>112709661623759566156255015500851204670</span>],[<span style=color:#ae81ff>306746575224464214911885995766809188593</span>,  <span style=color:#ae81ff>35156534122767743923667417474200538878</span>,  <span style=color:#ae81ff>35608800809152761271316580867239668942</span>, <span style=color:#ae81ff>259728427797578488375863755690441758142</span>,  <span style=color:#ae81ff>29823482469997458858051644485250558639</span>, <span style=color:#ae81ff>137507773879704381525141121774823729991</span>,  <span style=color:#ae81ff>29893063272339035080311541822496817623</span>, <span style=color:#ae81ff>292327683738678589950939775184752636265</span>]]
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> [[<span style=color:#ae81ff>133156758362160693874249080602263044484</span>, <span style=color:#ae81ff>293052519705504374237314478781574255411</span>,  <span style=color:#ae81ff>72149359944851514746901936133544542235</span>,  <span style=color:#ae81ff>56884023532130350649269153560305458687</span>,  <span style=color:#ae81ff>67693140194970657150958369664873936730</span>, <span style=color:#ae81ff>227562364727203645742246559359263307899</span>,  <span style=color:#ae81ff>98490363636066788474326997841084979092</span>, <span style=color:#ae81ff>323336812987530088571937131837711189774</span>],[<span style=color:#ae81ff>244725074927901230757605861090949184139</span>,  <span style=color:#ae81ff>63515536426726760809658259528128105864</span>, <span style=color:#ae81ff>297175420762447340692787685976316634653</span>, <span style=color:#ae81ff>279269959863745528135624660183844601533</span>, <span style=color:#ae81ff>203893759503830977666718848163034645395</span>, <span style=color:#ae81ff>163047775389856094351865609811169485260</span>, <span style=color:#ae81ff>103694284536703795013187648629904551283</span>, <span style=color:#ae81ff>322381436721457334707426033205713602738</span>],[ <span style=color:#ae81ff>17450567396702585206498315474651164931</span>, <span style=color:#ae81ff>105594468721844292976534833206893170749</span>,  <span style=color:#ae81ff>10757192948155933023940228740097574294</span>, <span style=color:#ae81ff>132150825033376621961227714966632294973</span>, <span style=color:#ae81ff>329990437240515073537637876706291805678</span>,  <span style=color:#ae81ff>57236499879418458740541896196911064438</span>, <span style=color:#ae81ff>265417446675313880790999752931267955356</span>,  <span style=color:#ae81ff>73326674854571685938542290353559382428</span>],[<span style=color:#ae81ff>270340230065315856318168332917483593198</span>, <span style=color:#ae81ff>217815152309418487303753027816544751231</span>,  <span style=color:#ae81ff>55738850736330060752843300854983855505</span>, <span style=color:#ae81ff>236064119692146789532532278818003671413</span>, <span style=color:#ae81ff>104963107909414684818161043267471013832</span>, <span style=color:#ae81ff>234439803801976616706759524848279829319</span>, <span style=color:#ae81ff>173296466130000392237506831379251781235</span>,  <span style=color:#ae81ff>34841816336429947760241770816424911200</span>],[<span style=color:#ae81ff>140341979141710030301381984850572416509</span>, <span style=color:#ae81ff>248997512418753861458272855046627447638</span>,  <span style=color:#ae81ff>58382380514192982462591686716543036965</span>, <span style=color:#ae81ff>188097853050327328682574670122723990784</span>, <span style=color:#ae81ff>125356457137904871005571726686232857387</span>,  <span style=color:#ae81ff>55692122688357412528950240580072267902</span>,  <span style=color:#ae81ff>21322427002782861702906398261504812439</span>,  <span style=color:#ae81ff>97855599554699774346719832323235463339</span>],[<span style=color:#ae81ff>298368319184145017709393597751160602769</span>, <span style=color:#ae81ff>311011298046021018241748692366798498529</span>, <span style=color:#ae81ff>165888963658945943429480232453040964455</span>, <span style=color:#ae81ff>240099237723525827201004876223575456211</span>, <span style=color:#ae81ff>306939673050020405511805882694537774846</span>,   <span style=color:#ae81ff>7035607106089764511604627683661079229</span>, <span style=color:#ae81ff>198278981512146990284619915272219052007</span>, <span style=color:#ae81ff>255750707476361671578970680702422436637</span>],[ <span style=color:#ae81ff>45315424384273600868106606292238082349</span>,  <span style=color:#ae81ff>22526147579041711876519945055798051695</span>,  <span style=color:#ae81ff>15778025992115319312591851693766890019</span>, <span style=color:#ae81ff>318446611756066795522259881812628512448</span>, <span style=color:#ae81ff>269954638404267367913546070681612869355</span>, <span style=color:#ae81ff>205423708248276366495211174184786418791</span>,  <span style=color:#ae81ff>92563824983279921050396256326760929563</span>, <span style=color:#ae81ff>209843107530597179583072730783030298674</span>],[   <span style=color:#ae81ff>662653811932836620608984350667151180</span>, <span style=color:#ae81ff>304181885849319274230319044357612000272</span>, <span style=color:#ae81ff>280045476178732891877948766225904840517</span>, <span style=color:#ae81ff>216340293591880460916317821948025035163</span>,  <span style=color:#ae81ff>79726526647684009633247003110463447210</span>,  <span style=color:#ae81ff>36010610538790393011235704307570914178</span>, <span style=color:#ae81ff>284067290617158853279270464803256026349</span>,  <span style=color:#ae81ff>45816877317461535723616457939953776625</span>]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C <span style=color:#f92672>=</span> matrix(enc)
</span></span><span style=display:flex><span>K <span style=color:#f92672>=</span> matrix(key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>inv_K <span style=color:#f92672>=</span> K<span style=color:#f92672>.</span>inverse()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>M <span style=color:#f92672>=</span> inv_K <span style=color:#f92672>*</span> C <span style=color:#f92672>*</span> inv_K
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print([bytes([i<span style=color:#f92672>%</span>p]) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> list(M)[<span style=color:#ae81ff>0</span>]])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> list(M):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> list(row):
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> x <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&lt;=</span> x <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>255</span>:
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> bytes([x])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;?&#34;</span>
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><p><code>ctf4b{d1d_y0u_pl4y_w1th_m4tr1x_4nd_g4l0is_f1eld?}</code></p><p>出力形式がぴえんこえてぱおん🐘</p><h3 id=crypto-logical_seesaw>[crypto] Logical_SEESAW<a hidden class=anchor aria-hidden=true href=#crypto-logical_seesaw>#</a></h3><p>複数回、同じ鍵で<code>flag</code>とandを取っていることがわかります。
andなので、<code>flag</code>がもともの<code>0</code>の箇所は鍵が何であれ<code>0</code>になります。
また、<code>flag</code>が<code>1</code>の場合は、鍵が<code>0</code>の場合は出力が2通りになり、鍵が<code>1</code>の場合は確率によらす<code>1</code>となります。</p><p>これを使えば、解けそうです
（なんか普通のwriteupになってきましたね、非常に疲れてきました、あと簡単な問題は試行錯誤もないので&mldr;許してください&mldr;）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> collections
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exec(open(<span style=color:#e6db74>&#34;output.txt&#34;</span>)<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>length <span style=color:#f92672>=</span> len(cipher[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(length):
</span></span><span style=display:flex><span>    bits <span style=color:#f92672>=</span> [c[i] <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> cipher]
</span></span><span style=display:flex><span>    cnt <span style=color:#f92672>=</span> collections<span style=color:#f92672>.</span>Counter(bits)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(cnt) <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        flag <span style=color:#f92672>+=</span> cnt<span style=color:#f92672>.</span>most_common()[<span style=color:#ae81ff>0</span>][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> int(flag, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>print(bytes<span style=color:#f92672>.</span>fromhex(hex(flag)[<span style=color:#ae81ff>2</span>:]))
</span></span></code></pre></div><p><code>ctf4b{Sh3_54w_4_SEESAW,_5h3_54id_50}</code></p><h3 id=crypto-simple_rsa>[crypto] simple_RSA<a hidden class=anchor aria-hidden=true href=#crypto-simple_rsa>#</a></h3><p>のこりcrypto一問です、最後の有終の美を飾るのはsimpleなRSA問題でした。</p><p>ビット長からわかるように、<code>flag</code>を<code>e</code>乗しても<code>n</code>より大きくなっていなさそうです。
square rootを取れば終わりです！</p><p>OK!sagemath!</p><pre tabindex=0><code class=language-python-console data-lang=python-console>$ sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.2, Release Date: 2020-10-24                     │
│ Using Python 3.8.5. Type &#34;help()&#34; for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage: n = 1768667184240039357473051203420012852133691956973597279167660505628677847323071842695850887894263158470481734230495929306050761407480055367057903339967904133486315690203093489519767754314220211
....: 07816294944514533513969621373774114778994925558309827014496925615941751626235809874531513284088501164540581623702737363560683196485671055124528937368669392002970716029942882582952317511179914081605
....: 69998347640357251625243671483903597718500241970108698224998200840245865354411520826506950733058870602392209113565367230443261205476636664049066621093558272244061778795051583920491406620090704660526
....: 753969180791952189324046618283
....: e = 3
....: c = 2137917515300171115086910841683630246868780573379713198802569241853937371507043427250428414885473159259719603892304533323193718760929680325131490239762871586989902516402983608765893308108131992
....: 60879441426084508864252450551111064068694725939412142626401778628362399359107132506177231354040057205570428678822068599327926328920350319336256613
....:
</code></pre><p><code>output.txt</code>からパラメータペっとして、<code>nth_root()</code>を使えば&mldr;</p><pre tabindex=0><code class=language-python-console data-lang=python-console>sage: m = c.nth_root(e)
sage: bytes.fromhex(hex(m)[2:])
b&#34;ctf4b{0,1,10,11...It&#39;s_so_annoying.___I&#39;m_done}&#34;
</code></pre><p>うお〜〜〜〜終わった！！！！！</p><h2 id=rta-約2h00m00s>RTA: 約2h00m00s<a hidden class=anchor aria-hidden=true href=#rta-約2h00m00s>#</a></h2><p>正確なタイムはわかりませんが、16:00にはツイートしてたので、2時間かからないぐらいでしょうか。</p><p>たぶんこの記事を書くほうが時間かかっています。
完全にImaginaryで燃え尽きていますね。
なんでこんな記事書いてるんだろって何度も思いました。</p><h2 id=おわりに>おわりに<a hidden class=anchor aria-hidden=true href=#おわりに>#</a></h2><p>やっべ〜〜、<a href="https://www.youtube.com/watch?v=wnkD-UfDWYY">魔女のお茶会</a>に遅刻する〜〜〜</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://y05h1k1ng.github.io/tags/rsa/>rsa</a></li><li><a href=https://y05h1k1ng.github.io/tags/lll/>lll</a></li><li><a href=https://y05h1k1ng.github.io/tags/knapsack/>knapsack</a></li><li><a href=https://y05h1k1ng.github.io/tags/matrix/>matrix</a></li></ul><nav class=paginav><a class=prev href=https://y05h1k1ng.github.io/posts/cakectf-2021/><span class=title>« 前のページ</span><br><span>CakeCTF 2021 振り返り</span></a>
<a class=next href=https://y05h1k1ng.github.io/posts/hello_world/><span class=title>次のページ »</span><br><span>Hello World</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share SECCON Beginners CTF 2021 参加記 on twitter" href="https://twitter.com/intent/tweet/?text=SECCON%20Beginners%20CTF%202021%20%e5%8f%82%e5%8a%a0%e8%a8%98&url=https%3a%2f%2fy05h1k1ng.github.io%2fposts%2fseccon-beginners-2021%2f&hashtags=rsa%2clll%2cknapsack%2cmatrix"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SECCON Beginners CTF 2021 参加記 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fy05h1k1ng.github.io%2fposts%2fseccon-beginners-2021%2f&title=SECCON%20Beginners%20CTF%202021%20%e5%8f%82%e5%8a%a0%e8%a8%98&summary=SECCON%20Beginners%20CTF%202021%20%e5%8f%82%e5%8a%a0%e8%a8%98&source=https%3a%2f%2fy05h1k1ng.github.io%2fposts%2fseccon-beginners-2021%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SECCON Beginners CTF 2021 参加記 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fy05h1k1ng.github.io%2fposts%2fseccon-beginners-2021%2f&title=SECCON%20Beginners%20CTF%202021%20%e5%8f%82%e5%8a%a0%e8%a8%98"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SECCON Beginners CTF 2021 参加記 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fy05h1k1ng.github.io%2fposts%2fseccon-beginners-2021%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SECCON Beginners CTF 2021 参加記 on whatsapp" href="https://api.whatsapp.com/send?text=SECCON%20Beginners%20CTF%202021%20%e5%8f%82%e5%8a%a0%e8%a8%98%20-%20https%3a%2f%2fy05h1k1ng.github.io%2fposts%2fseccon-beginners-2021%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SECCON Beginners CTF 2021 参加記 on telegram" href="https://telegram.me/share/url?text=SECCON%20Beginners%20CTF%202021%20%e5%8f%82%e5%8a%a0%e8%a8%98&url=https%3a%2f%2fy05h1k1ng.github.io%2fposts%2fseccon-beginners-2021%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://y05h1k1ng.github.io/>yoshikingのへや</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css integrity=sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js integrity=sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body></html>